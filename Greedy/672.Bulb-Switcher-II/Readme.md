### 672.Bulb-Switcher-II

此题对于分析题意有这非常高的要求。

首先，我们考虑操作次数m的性质。因为总共有4种操作，当m>=5时，必然至少有两种操作是相同，而两次相同的操作会相互对消，等同于m==3。当m==6时，要么再增加一种从未出现过的新操作（使得等效的m==4)，要么再对消一种操作（使得等效的m==2）.以此类推，m的考察范围其实只要限制在m<=4即可。

以上其实还可以更进一步。当m==4时，说明可能是两种情况：第一种是列举的四种操作都出现了（各占一次），那么因为操作1其实不影响最终答案，所以等效为m==3。第二种是有某一种操作进行了两次，那么根据两次对消原理，等效为m==2.综上，m的考察范围其实只要限制在m<=3即可。

然后，我们考虑灯泡数量n的性质。我们假设n=k1+k2+k3+k4，k(i)表示第i种操作的数目。我们易知，灯泡1最终变化的次数是 k1+k2+k4，灯泡2最终变化的次数是 k1+k3，灯泡3最终变化的次数是 k1+k2. 这时候我们来看灯泡4，它的变化次数是 k1+k3+k4，恰好是灯泡1-灯泡2+灯泡3，所以灯泡4的状态完全是由灯泡1~3的状态决定的，本身并不是一个自由变化的量。同理可以分析灯泡5及以后的灯泡，也都不是自由量。所以，n的考察范围其实也只要限制在n<=3即可。

对于m<=3，n<=3，穷举都不是问题。

当m==0时：没有操作，return 1.

当n==1时：m次操作的选择，可以使得第一个灯泡亮也可以使得其不亮。所以return 2.

当n==2时：m==1，return 1；m==2，输出可以是 (1,2)->(on,off),(1,3)->(off,on),(2,3)->(off,off),(1,1)->(on,on),所以return 4

当n==3时：m==1，return 1；m==2，总共10种操作（11，12，13，14，22，23，24，33，34，44，先后顺序不影响），穷举一下，发现除了(of,on,on)的状态无法达成外，其余都可以，所以return 2^3-1=7；m==3，所有状态都可以达成，所以return 2^3=8
